<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<view xmlns="http://jmix.io/schema/flowui/view"
      xmlns:maps="http://jmix.io/schema/maps/ui"
      title="msg://tourExplorerView.title">
    <data>
        <collection id="citiesDc" class="com.company.tour.entity.City">
            <loader id="citiesDl" readOnly="true">
                <query>
                    <![CDATA[select e from City e]]>
                </query>
            </loader>
            <fetchPlan extends="_base"/>
        </collection>
        <collection id="cityDistrictsDc" class="com.company.tour.entity.CityDistrict">
            <loader id="cityDistrictsDl" readOnly="true">
                <query>
                    <![CDATA[select e from CityDistrict e where e.city = :component_citiesComboBox]]>
                </query>
            </loader>
            <fetchPlan extends="_base"/>
        </collection>
        <collection id="toursDc" class="com.company.tour.entity.Tour">
            <fetchPlan extends="_base"/>
            <loader id="toursDl" readOnly="true">
                <query>
                    <![CDATA[select e from Tour e where e.city = :component_citiesComboBox]]>
                </query>
            </loader>
        </collection>
        <collection id="stopsDc" class="com.company.tour.entity.Stop">
            <loader id="stopsDl" readOnly="true">
                <query>
                    <![CDATA[select e from Stop e inner join e.tours tr where tr.city = :component_citiesComboBox]]>
                </query>
            </loader>
            <fetchPlan extends="_base"/>
        </collection>
    </data>
    <facets>
        <dataLoadCoordinator auto="true"/>
    </facets>
    <layout>
        <entityComboBox id="citiesComboBox" metaClass="City" itemsContainer="citiesDc"/>
        <maps:geoMap id="map" width="100%" height="100%">
            <maps:mapView zoom="13" centerX="13.38" centerY="52.515"/>
            <maps:layers>
                <maps:tile>
                    <maps:osmSource/>
                </maps:tile>
                <maps:vector id="districtsLayer">
                    <maps:dataVectorSource id="districtsSource" dataContainer="cityDistrictsDc" property="area"/>
                </maps:vector>
                <maps:vector id="toursLayer">
                    <maps:dataVectorSource id="toursSource" dataContainer="toursDc" property="route"/>
                </maps:vector>
                <maps:vector id="stopsLayer">
                    <maps:dataVectorSource id="stopsSource" dataContainer="stopsDc" property="location"/>
                </maps:vector>
            </maps:layers>
        </maps:geoMap>
    </layout>
</view>